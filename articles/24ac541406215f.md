---
title: "SvelteKitã§é™çš„ã‚µã‚¤ãƒˆã‚’ä½œæˆã—ã€GitHub Pagesã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã¾ã§"
emoji: "ğŸ˜"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["svelte", "sveltekit", "github pages"]
published: true
---

ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã§ã‚¢ãƒ—ãƒªã‚’æ›¸ãã“ã¨ãŒã‚ã£ãã‚Šæ¸›ã£ã¡ã‚ƒã£ãŸãªãƒ¼ã€ã¨ã®æ˜¨å¹´ã®åçœã‹ã‚‰ã€2023å¹´å§‹ã¯v1.0ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚ŒãŸã¦ã®SvelteKitã§éŠã‚“ã§ã„ã¾ã—ãŸã€‚

https://kit.svelte.jp/

https://svelte.jp/blog/announcing-sveltekit-1.0

SvelteKitä¸Šã§ã®é–‹ç™ºã¯ç°¡å˜ãªæ¤œè¨¼ç¨‹åº¦ã§æ¸ˆã¾ã—ãªãŒã‚‰ã€SSGã¨ã—ã¦é™çš„ãƒªã‚½ãƒ¼ã‚¹ã‚’åãå‡ºã—ãŸä¸Šã§GitHub Pagesã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã¾ã§ã€ã¨ã®ä¸€è²«ã—ãŸãƒ•ãƒ­ãƒ¼ã‚’ä¸€é€šã‚Šè¸ã‚“ã ãŸã‚ã€ä»Šå›ã¯ç‰¹ã«é–‹ç™ºå®Œäº†å¾Œã®

- é™çš„ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œã‚‹æ§˜ã«è¨­å®šã‚’ã—ã¦
- GitHub Pagesã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹

ã®éƒ¨åˆ†ã®æ‰‹é †ã‚’ãƒ¡ãƒ¢ã¨ã—ã¦æ›¸ãè½ã¨ã—ã¾ã™ã€‚

# SvelteKit

## `adapter-static` ã‚’è¨­å®šã™ã‚‹

https://kit.svelte.jp/docs/adapters

SvelteKitã¯ãƒ“ãƒ«ãƒ‰ã‚’è¡Œã£ãŸå¾Œã€`adapter` ã¨å‘¼ã°ã‚Œã‚‹æ©Ÿæ§‹ã§ãƒ‡ãƒ—ãƒ­ã‚¤ç”¨ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’ç”Ÿæˆã™ã‚‹æ§˜ã§ã™ã€‚GitHub Pagesã¯ `index.html` ã‚’ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆã«ã—ãŸé™çš„ãƒªã‚½ãƒ¼ã‚¹ã‚’æ±‚ã‚ã¦ã„ã‚‹ãŸã‚ã€`adapter` å‘¨ã‚Šã‚‚é™çš„ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œã‚‹æ§˜ã«å®šç¾©ã‚’æ›¸ã„ã¦ã„ãã¾ã™ã€‚

ã¾ãšã€`svelte.config.js` ã§ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹ `adapter` ã‚’ `adapter-static` ã«ä¿®æ­£ã€‚

```bash
$ npm i -D @sveltejs/adapter-static
```

```diff js:svelte.config.js
- import adapter from '@sveltejs/adapter-auto';
+ import adapter from '@sveltejs/adapter-static';

/** @type {import('@sveltejs/kit').Config} */
const config = {
    kit: {
        adapter: adapter()
    }
};

export default config;
```

## `src/routes` ã® `+layout.js` ã§ãƒ—ãƒªãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å¯¾è±¡ã§ã‚ã‚‹ã“ã¨ã‚’è¨­å®šã™ã‚‹

https://github.com/sveltejs/kit/tree/master/packages/adapter-static#usage

`adapter-static` ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«æ²¿ã„ã€æœ€ä¸Šä½ã® `+layouts.js` ã«ã¦ãƒ—ãƒªãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹æ§˜ã«è¨­å®šã‚’ã—ã¾ã™ã€‚

```diff js:src/routes/+layouts.js
+ export const prerender = true;
```

åŸºæœ¬çš„ã«ã€SvelteKitã§ã®é™çš„ãƒªã‚½ãƒ¼ã‚¹ç”Ÿæˆã¯ã“ã‚Œã§å®Œäº†ã§ã™ã€‚ã‚ã¡ã‚ƒãã¡ã‚ƒç°¡å˜ï¼

```bash
$ npm run build
```

ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€`build` é…ä¸‹ã«ãƒªã‚½ãƒ¼ã‚¹ãŒé…ç½®ã•ã‚Œã¾ã™ãŒã€ãã®ä¸­ã«ã¯ `index.html` ç­‰ã®é™çš„ãƒªã‚½ãƒ¼ã‚¹ãŒãã¡ã‚“ã¨é…ç½®ã•ã‚Œã¦ã„ã‚‹ã¨æ€ã„ã¾ã™ã€‚

## GitHub Pageså‘ã‘ï¼ãƒ™ãƒ¼ã‚¹ãƒ‘ã‚¹ã‚’è¨­å®šã™ã‚‹

https://github.com/sveltejs/kit/tree/master/packages/adapter-static#github-pages

ãŸã ã—ã€GitHub Pagesã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹å ´åˆã¯

```diff txt
# local
- https://localhost:XXXX
# GitHub Pages
+ https://{ãƒ¦ãƒ¼ã‚¶ãƒ¼å}.github.io/{ãƒªãƒã‚¸ãƒˆãƒªå}
```

ã¨ã€ãƒ«ãƒ¼ãƒˆãƒ‘ã‚¹ã¨ã—ã¦ãƒ›ã‚¹ãƒˆåã«ãƒ—ãƒ©ã‚¹ã§ `{ãƒªãƒã‚¸ãƒˆãƒªå}` ãŒå¿…è¦ã«ãªã‚‹ãŸã‚ã€è‹¥å¹²è¨­å®šã‚’è¶³ã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```diff js:svelte.config.js
import adapter from '@sveltejs/adapter-static';

+ const dev = process.argv.include('dev');

/** @type {import('@sveltejs/kit').Config} */
const config = {
    kit: {
        adapter: adapter(),
+        paths: {
+            base: dev ? '' : '/{ãƒªãƒã‚¸ãƒˆãƒªå}'
+        }
    }
};

export default config;
```

ä¸Šè¨˜ã¯ `adapter-static` ã®ã‚µãƒ³ãƒ—ãƒ«ã®ã¾ã¾ã§ã™ãŒã€æœ¬ç•ªã®å ´åˆã¯ãƒ™ãƒ¼ã‚¹ãƒ‘ã‚¹ã« `{ãƒªãƒã‚¸ãƒˆãƒªå}` ã‚’è¨­å®šã™ã‚‹æ§˜ã«ã—ã¦ã„ã¾ã™ã€‚ã¡ã‚ƒã‚“ã¨ã—ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãªã‚‰ã° `NODE_ENV` ã§åˆ¤åˆ¥ã™ã‚‹å½¢ã§æ›¸ãã¨æ€ã„ã¾ã™ãŒã€ã‚„ã‚‹ã“ã¨ã¨ã—ã¦ã¯ä¸Šè¨˜ã¨å¤§å·®ç„¡ã„ç†è§£ã§ã™ã€‚

`paths.base` ã‚’è¨­å®šã™ã‚‹ã¨ã€ã‚¢ãƒ—ãƒªä¸Šã§æ›¸ãç›¸å¯¾ãƒ‘ã‚¹å‘¨ã‚Šã‚‚ä¸‹è¨˜ã®æ§˜ã« `$app/paths` ã‹ã‚‰å‘¼ã³å‡ºã™å½¢ã§æ›¸ãã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚

```diff svelte:sample.svelte
<script>
+    import { base } from '$app/paths';
</script>

- <a href="/posts/a"></a>
+ <a href="{base}/posts/a"></a>
```

`npm run build` ã‚’å†åº¦èµ°ã‚‰ã›ã¦ã€ãƒªãƒ³ã‚¯ç®‡æ‰€ã®ãƒ‘ã‚¹ã« `base` ã§æŒ‡å®šã—ãŸè¨­å®šãŒå…¥ã£ã¦ã„ã‚Œã°æˆåŠŸã§ã™ï¼

# GitHub

## ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æº–å‚™ã™ã‚‹

ä»Šå›ã¯GitHub Actionsã‹ã‚‰GitHub Pagesã«ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’ã‹ã‘ã‚‹ã¹ãã€ãƒšãƒ¼ã‚¸ç”¨ã®ãƒ–ãƒ©ãƒ³ãƒã‚’ç”Ÿæˆã™ã‚‹ãŸã‚ã€ãƒªãƒã‚¸ãƒˆãƒªæ“ä½œç”¨ã«ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã—ã¦ãŠãã¾ã™ã€‚

ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã¯ã€ŒSettings -> Developer settings -> Personal access tokensã€ã§ç”Ÿæˆå‡ºæ¥ã¾ã™ã€‚æ¨©é™ç¯„å›²ã¯ `repo` ã«ãƒã‚§ãƒƒã‚¯ãŒå…¥ã£ã¦ã„ã‚Œã°å•é¡Œç„¡ã—ã€‚

ç”ŸæˆãŒå®Œäº†ã™ã‚‹ã¨ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ãŒä¸€åº¦é™ã‚Šè¡¨ç¤ºã•ã‚Œã‚‹ãŸã‚ã€ã‚¨ãƒ‡ã‚£ã‚¿ç­‰ã«æ§ãˆã¦ãŠãã¾ã—ã‚‡ã†ã€‚

## ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’Secretsã«è¨­å®šã™ã‚‹

ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã®æ§˜ãªæ©Ÿå¯†æƒ…å ±ã‚’åˆ©ç”¨ã™ã‚‹å ´åˆã¯ã€GitHubå´ã§æä¾›ã‚’ã—ã¦ã„ã‚‹ã‚­ãƒ¼ã‚¹ãƒˆã‚¢ã§ã‚ã‚‹Secretsã®ä»•çµ„ã¿ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚

ã€ŒSettings -> Secrets -> Actionsã€ã«è¡Œãã¨ã€ã€ŒNew repository secretã€ã¨ã®ãƒœã‚¿ãƒ³ãŒã‚ã‚‹ãŸã‚ã€ã“ã¡ã‚‰ã‹ã‚‰ã‚­ãƒ¼ï¼ãƒãƒªãƒ¥ãƒ¼ã®å½¢å¼ã§ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¨­å®šã—ã¾ã™ã€‚ä»Šå›ã¯ `GH_API_TOKEN` ã¨ã—ã¦ç™»éŒ²ã‚’ã—ãŸã¨ã—ã¾ã™ã€‚

## GitHub Actionsã‚’çµ„ã‚€

è¨­å®šä¾‹ã‚’é…ç½®ã—ã¦ãŠãã¾ã™ã€‚

```yaml:deploy-to-github-pages.yml
name: deploy-to-github-pages

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: setup node.js
        uses: actions/setup-node@v3.6.0
      
      # package.jsonã®å†…å®¹ã§ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
      - name: setup app env
        run: npm i
      
      # ãƒ“ãƒ«ãƒ‰å®Ÿè¡Œã€é™çš„ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œã‚‹
      - name: build static resources
        run: npm run build
          
      # GitHub Pagesã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹
      - name: deploy to github pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GH_API_TOKEN }}
          # ã‚¢ãƒ—ãƒªç›´ä¸‹ã®buildãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç”Ÿæˆã•ã‚Œã‚‹ãŸã‚ã€æŒ‡å®š
          publish_dir: build
```

ã‚ã¡ã‚ƒãã¡ã‚ƒç°¡å˜ï¼

# ã¾ã¨ã‚

ã°ã£ã•ã‚Šã¨çœã„ãŸé–‹ç™ºç®‡æ‰€ã‚‚å«ã‚ã¦ã§ã™ãŒã€ç°¡å˜ãƒ»ç°¡ç´ ãªãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§æœ€é«˜ã§ã™ã€‚Svelteæœ¬ä½“ãŒå®¹é‡ãƒ»ã‚³ãƒ¼ãƒ‰è¨˜è¿°é‡ã®ä¸¡é¢ã‹ã‚‰ç°¡ç´ ã•ã‚’é‡ã‚“ã˜ãŸãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆæ­£ã—ãã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãªã®ã§ã™ãŒï¼‰ã§ã—ãŸãŒã€SvelteKitã‚‚ãã®ãƒãƒªã‚·ãƒ¼ã‚’ã—ã£ã‹ã‚Šã¨å¤§äº‹ã«ã—ãŸä»•ä¸ŠãŒã‚Šã§ã€é¢å€’ãªç®‡æ‰€ãŒã»ã¨ã‚“ã©ç„¡ã‹ã£ãŸã§ã™ã€‚ã“ã†ã„ã†ã®ã§ã„ã„ã‚“ã ã‚ˆã€ã“ã†ã„ã†ã®ã§ã€‚

Nuxtã‚‚Nextã‚‚ã€å€‹äººçš„ã«ã¯ãƒ‡ãƒ•ã‚¡ã‚¯ãƒˆã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ã«ãªã‚‹éç¨‹ã§ã€ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¨ã—ã¦ã‚«ãƒãƒ¼ã™ã‚‹ç¯„å›²ãŒåºƒãŒã£ãŸçµæœã€å„æ‰€ã§ã‚„ã‚ŠãŸã„ã“ã¨ã®ã‚·ãƒ³ãƒ—ãƒ«ã•ã«æ¯”ã¹ã‚‹ã¨ä½œã‚ŠãŒé¢å€’ã«ãªã£ã¡ã‚ƒã†ãªãƒ¼ã€ã¨ã®å ´é¢ã«ã„ãã‚‰ã‹é­é‡ã™ã‚‹æ§˜ã«ãªã£ãŸæ„Ÿè¦šãŒã‚ã‚Šã¾ã™ï¼ˆNuxt3ã¯ç’°å¢ƒå¤‰æ•°å‘¨ã‚Šã§ã‚ã¡ã‚ƒãã¡ã‚ƒãƒãƒã£ãŸã€ã€ï¼‰ã€‚SvelteKitã¯æ ¹æœ¬ã®ãƒãƒªã‚·ãƒ¼ã§ã‚ã‚‹ç°¡ç´ ã•ã‚’é‡ã‚“ã˜ãŸã¾ã¾ã€ã“ã®èª¿å­ã§ã•ã‚‰ãªã‚‹æ´—ç·´ã‚’æ¥½ã—ã¿ã«ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚